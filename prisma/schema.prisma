generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// TRAINING PLANS (CORE ENGINE)
//

model training_plans {
  id                     String   @id @default(cuid())
  athleteId              String   // reference by string only
  raceId                 String?

  name                   String
  goalTime               String?
  goalRacePace           Int?
  predictedRacePace      Int?
  current5KPace          String?
  currentWeeklyMileage   Int?
  preferredDays          Int[]

  startDate              DateTime
  totalWeeks             Int

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  goalPace5K             String?

  training_plan_days     training_plan_days[]
  training_plan_phases   training_plan_phases[]
  training_plan_weeks    training_plan_weeks[]

  race_registry          race_registry? @relation(fields: [raceId], references: [id])
}

//
// PHASES
//

model training_plan_phases {
  id                     String   @id @default(cuid())
  planId                 String

  name                   String
  weekCount              Int
  totalMiles             Float?
  phaseDescription       String?
  phaseTotalMilesTarget  Float?
  longRunProgression     Int[]   @default([])
  qualityWorkoutsPerWeek Int     @default(1)
  runTypesEnabled        Json?

  phaseStartDate         DateTime
  phaseEndDate           DateTime

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  training_plans         training_plans @relation(fields: [planId], references: [id], onDelete: Cascade)
  training_plan_days     training_plan_days[]
  training_plan_weeks    training_plan_weeks[]

  @@unique([planId, name])
}

//
// WEEKS
//

model training_plan_weeks {
  id                   String   @id @default(cuid())
  planId               String
  phaseId              String

  weekNumber           Int
  miles                Float?

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  training_plans       training_plans       @relation(fields: [planId], references: [id], onDelete: Cascade)
  training_plan_phases training_plan_phases @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  training_plan_days   training_plan_days[]

  @@unique([planId, weekNumber])
}

//
// DAYS
//

model training_plan_days {
  id                   String @id @default(cuid())
  planId               String
  phaseId              String
  weekId               String

  date                 DateTime
  dayOfWeek            Int

  warmup               Json
  workout              Json
  cooldown             Json
  notes                String?

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  training_plans       training_plans       @relation(fields: [planId], references: [id], onDelete: Cascade)
  training_plan_phases training_plan_phases @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  training_plan_weeks  training_plan_weeks  @relation(fields: [weekId], references: [id], onDelete: Cascade)

  @@unique([planId, date])
}

//
// RACES
//

model race_registry {
  id        String   @id @default(cuid())
  name      String
  raceType  String
  miles     Float
  date      DateTime

  city      String?
  state     String?
  country   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  training_plans training_plans[]
}
